function ErrorDialog(t,e,o,n){t.title=o,t.errors=n,t.close=function(){e.hide()}}function LoadingDialog(t,e,o){t.title=o,t.close=function(){e.hide()}}function ConfirmDialog(t,e,o,n){t.title=n.title||"Confirm",t.message=o.trustAsHtml(n.message||""),t.ok=function(){"function"==typeof n.onOk&&n.onOk.call(t,n),e.hide()},t.cancel=function(){"function"==typeof n.onCancel&&n.onCancel.call(t,n),e.hide()}}ErrorDialog.$inject=["$scope","$mdDialog","title","errors"],LoadingDialog.$inject=["$scope","$mdDialog","title"],ConfirmDialog.$inject=["$scope","$mdDialog","$sce","params"],Date.now||(Date.now=function(){return(new Date).getTime()}),window.console&&window.console.log||(window.console={log:function(){}});var cms={submit:function(t){if(t="object"==typeof t?t:{},"undefined"==typeof t.form?(0===$("#cms-hidden-form").length&&$("body").append('<form id="cms-hidden-form" name="cms-hidden-form" action="" method="post"></form>'),t.form=$("#cms-hidden-form")):"string"==typeof t.form&&(t.form=$(t.form)),"object"==typeof t.form&&1===t.form.length){var e=t.form,o="string"==typeof t.data?$.query(t.data):t.data;if(e.html(""),e.attr("action",""),"string"==typeof t.action&&e.attr("action",t.action),e.get(0).setAttribute("target",""),"string"==typeof t.target){e.get(0).setAttribute("target",t.target);var n=$("#"+t.target);n.length&&(n.off("load"),"function"==typeof t.onload&&n.load(t.onload))}if("object"==typeof o)for(var i in o)if("string"==typeof o[i]||"number"==typeof o[i])e.append("<input type='hidden' name='"+i+"' value='"+unescape(urldecode(o[i]).replace(/\'/gi,"&apos;"))+"' />");else if($.isArray(o[i]))for(var r=0;r<o[i].length;r++)e.append("<input type='hidden' name='"+i+"[]' value='"+unescape(urldecode(o[i][r]).replace(/\'/gi,"&apos;"))+"' />");e.submit()}return!1}},pages=angular.module("pages",[]),firebase_url="https://rodriguez.firebaseio.com/notes",app=angular.module("NotesApp",["pages","ngMdIcons","ngMaterial","ngMessages","ngRoute","contenteditable"]);app.config(["$routeProvider","$mdThemingProvider",function(t,e){e.theme("default").primaryPalette("blue").accentPalette("lime"),t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/export",{templateUrl:"views/export.html",controller:"ExportCtrl"}).otherwise({redirectTo:"/"})}]),app.factory("fb",[function(){return new Firebase(firebase_url)}]),/edrodriguez\.com$/i.test(location.host)&&(!function(t,e,o,n,i,r,a){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*new Date,r=e.createElement(o),a=e.getElementsByTagName(o)[0],r.async=1,r.src=n,a.parentNode.insertBefore(r,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-66592052-1","auto"),ga("send","pageview")),function(t){var e=navigator.userAgent.toLowerCase();t.browser={version:(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)},t.fn.selectRange=function(t,e){return e||(e=t),this.each(function(){if("undefined"!=typeof this.setSelectionRange)this.focus(),this.setSelectionRange(t,e);else if("undefined"!=typeof this.createTextRange){var o=this.createTextRange();o.collapse(!0),o.moveEnd("character",e),o.moveStart("character",t),o.select()}})},t.fn.outerHTML=function(e){return e?this.before(e).remove():t("<p>").append(this.eq(0).clone()).html()},t.fn.serializeObject=function(){var e={},o=this.serializeArray(),n=t("[data-hint]",this);return t.each(o,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||"";var t=n.filter('[name="'+this.name+'"]');1===t.length&&e[this.name]===t.attr("data-hint")&&(e[this.name]="")}),e},t.fn.serializeElement=function(){for(var e=t(this),o=t("<form></form>").append(e.clone()),n=["textarea","select",'input[type="text"]','input[type="hidden"]','input[type="checkbox"]','input[type="radio"]'],i=0;i<n.length;i++){var r=n[i],a=e.find(r);a.each(function(e){var n=t(this);n.get(0).tagName.match(/^(input)$/i)&&"undefined"!=typeof n.attr("type")&&n.attr("type").match(/^(checkbox|radio)$/i)?t(o).find(r).eq(e).attr("checked",n.attr("checked")):t(o).find(r).eq(e).val(n.val())})}return o.serializeObject()},t.fn.imagesLoaded=function(e,o){o="undefined"==typeof o?0:o;var n=t("img",this),i=n.length,r=1;t.cms.log("Images Total: "+n.length),n.length?n.each(function(a,s){var l=t(this);l.on("load",function(a){r&&(i--,o?(t.cms.log("Loaded"),i||("function"==typeof e&&e.call(n,a),t.cms.log("Images Loaded"),r=0)):("function"==typeof e&&e.call(n,a),i||(t.cms.log("Images Loaded"),r=0)))}),(this.complete||void 0===this.complete)&&(this.src=this.src)}):"function"==typeof e&&e.call(this)},t.hook=function(e,o){e="string"==typeof e?e.split(/,? +/):e,e=e instanceof Array?e:[];for(var n=0;n<e.length;n++){var i=e[n];if(!isEmpty(i)&&t.fn[i]){var r=t.fn[i];r&&(t.fn[i]=function(){var t=r.apply(this,arguments);return o(this,i,arguments),t},t.cms.log(i))}}},t.getJSONP=function(e){function o(t,e,o,i){t.error(n,i)}e.dataType="jsonp";var n=t.ajax(e),i=t(document.getElementsByTagName("head")[0].firstChild),r=i.attr("src")||"",a=(r.match(/callback=(\w+)/)||[])[1];if(a){var s=0,l=window[a];i[0].onerror=function(t){i.remove(),o(e,{},"error",t),clearTimeout(s)},e.timeout&&(window[a]=function(t){clearTimeout(s),l(t),l=null},s=setTimeout(function(){i.remove(),o(e,{},"timeout"),l&&(window[a]=function(){})},e.timeout))}},t.query=function(e){var o={};return e="undefined"==typeof e?document.location.search:e,e&&(e.indexOf("?")>=0&&(e=e.substring(e.indexOf("?")+1)),e.indexOf("#")>=0&&(e=e.substring(0,e.indexOf("#"))),e=e.replace(/\&amp;/,"&"),e=e.replace(/\&$/,""),t.each(e.split("&"),function(){var t=this.split("=");if(2===t.length){var e=t[0],n=t[1];/^[0-9.]+$/.test(n)&&(n=parseFloat(n)),"true"==n&&(n=!0),"false"==n&&(n=!1),("number"==typeof n||"boolean"==typeof n||n.length>0)&&(o[e]=n)}else 1===t.length&&(o[t[0]]="")})),o},t.extend({stringify:function(e){if("JSON"in window)return JSON.stringify(e);var o=typeof e;if("object"!=o||null===e)return"string"==o&&(e='"'+e+'"'),String(e);var n,i,r=[],a=e&&e.constructor==Array;for(n in e)i=e[n],o=typeof i,e.hasOwnProperty(n)&&("string"==o?i='"'+i+'"':"object"==o&&null!==i&&(i=t.stringify(i)),r.push((a?"":'"'+n+'":')+String(i)));return(a?"[":"{")+String(r)+(a?"]":"}")}})}(jQuery),app.controller("AppCtrl",["$scope","$timeout","$mdSidenav","$log","$rootScope","AppService",function(t,e,o,n,i,r){function a(o,n,i){var r;return function(){var i=t,a=Array.prototype.slice.call(arguments);e.cancel(r),r=e(function(){r=void 0,o.apply(i,a)},n||10)}}function s(t){return a(function(){o(t).toggle()},200)}function l(t){return function(){o(t).toggle()}}n.info("AppCtrl"),this.app=r,angular.element(document).ready(function(){document.getElementById("loading").style.display="none",document.getElementById("notes-app").style.display="flex"}),t.app=r,t.title=r.title,t.$watch("app.getTitle()",function(e){t.title=e}),t.auth=function(){return r.getAuth()},t.add=function(){r.add(),o("left").close()},t.toggleLeft=s("left"),t.toggleRight=l("right"),t.isOpenRight=function(){return o("right").isOpen()}}]),pages.controller("ExportCtrl",["$scope","$location","$mdDialog","$log","AppService","$sce","fb",function(t,e,o,n,i,r,a){if(n.info("ExportCtrl"),i.getAuth()||e.path("/login"),i.setTitle("Export"),i.notes){for(var s=JSON.parse(JSON.stringify(i.notes)),l=0;l<s.length;l++){var c=s[l].note;c=c.replace(/<br>/gi,"[br]");var d=$("<div></div>").html(c);s[l].note=d.text().replace(/\[br\]/gi,"\n"),s[l].created&&(s[l].created=moment(s[l].created).format("M/D/YY h:mma")),s[l].updated&&(s[l].updated=moment(s[l].updated).format("M/D/YY h:mma"))}s=JSON.stringify(s),s=s.replace(/\",\"/gi,'",\n"'),s=s.replace(/(\d),\"/gi,'$1,\n"'),s=s.replace(/\},\{/gi,"},\n{"),s=s.replace(/\{\"/gi,'{\n"'),s=s.replace(/\"\}/gi,'"\n}'),s=s.replace(/^\"/gim,'	"'),s=s.replace(/\":(\"|\d)/gi,'": $1'),s=s.replace(/\s*\"\$\$hashKey\":\s*\"object\:\d+\",?\n/gi,"\n"),s=s.replace(/\s*\"id\"\: \d+,\n/gi,"\n"),s=r.trustAsHtml(s),t.notes=s}else t.notes=""}]),app.controller("LeftCtrl",["$scope","$timeout","$log","$mdSidenav","AppService","$location",function(t,e,o,n,i,r){o.info("LeftCtrl"),t.app=i,t.isSelected=function(t){return t&&i.note?t.id===i.note.id:0},t.close=function(){n("left").close()},t.show=function(t){/^\/$/.test(r.$$path)||r.path("/"),i.show(t),n("left").close()},t.hide=function(e){if(t.search){var o=new RegExp(t.search,"gi");return!o.test(e.name)}return!1},t.auth=i.getAuth}]),pages.controller("LoginCtrl",["$scope","$location","$mdDialog","$log","AppService","fb",function(t,e,o,n,i,r){n.info("LoginCtrl"),i.setTitle("Log in to Notes"),t.email="",t.password="",t.login=function(e){var i=!0;if(e&&e.currentTarget&&/^input$/i.test(e.currentTarget.tagName)&&e.which&&(i=13===e.which?!0:!1),i){var a=[];if(t.email||a.push("Email is required"),t.password||a.push("Password is required"),a.length)o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Log In Error",errors:a},parent:"body",controller:ErrorDialog});else{var s=$(e.currentTarget);s.prop("disabled",!1),o.show({templateUrl:"views/dialogs/loading.html",locals:{title:"Logging In..."},parent:"body",controller:LoadingDialog,onComplete:function(){r.authWithPassword({email:t.email,password:t.password},function(t,e){if(s.prop("disabled",!1),t){n.warn("Log In Failed!",t);var i=[];i.push(t.toString().replace(/^Error:/,"").trim()),o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Log In Failed",errors:i},parent:"body",controller:ErrorDialog})}})}})}}}}]),pages.controller("MainCtrl",["$scope","$location","$rootScope","$log","AppService",function(t,e,o,n,i){n.info("MainCtrl"),i.getAuth()||e.path("/login"),i.setTitle("Notes"),this.app=i,t.formatDate=function(t,e){return moment(t).format(e)},t.isEmpty=function(t){return t=t?t.replace(/\<br\s*\/?\>/gi,"").trim():"",""===t}}]),app.controller("RightCtrl",["$scope","$mdSidenav","$mdDialog","$log","AppService",function(t,e,o,n,i){n.info("RightCtrl"),t.close=function(){e("right").close()},t.logout=function(){o.show({templateUrl:"views/dialogs/loading.html",locals:{title:"Logging Out..."},parent:"body",controller:LoadingDialog,onComplete:function(){i.logout(),e("right").close()}})}}]),pages.controller("SignupCtrl",["$scope","$location","$mdDialog","$log","AppService","fb",function(t,e,o,n,i,r){n.info("SignupCtrl"),i.getAuth()&&e.path("/"),i.setTitle("Sign up for Notes"),t.email="",t.password="",t.signup=function(e){var i=!0;if(e&&e.currentTarget&&/^input$/i.test(e.currentTarget.tagName)&&e.which&&(i=13===e.which?!0:!1),i){var a=[];if(t.first_name||a.push("First Name is required"),t.last_name||a.push("Last Name is required"),t.email||a.push("Email is required"),t.password?t.password.length<8&&a.push("Passwords are required a minimum of 8 characters"):a.push("Password is required"),a.length)o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Sign Up Error",errors:a},parent:"body",controller:ErrorDialog});else{var s=$(e.currentTarget);s.prop("disabled",!1),o.show({templateUrl:"views/dialogs/loading.html",locals:{title:"Signing Up..."},parent:"body",controller:LoadingDialog,onComplete:function(){r.createUser({email:t.email,password:t.password},function(e,i){if(e){n.warn("Sign Up Failed",e),s.prop("disabled",!1);var a=[];a.push(e.toString().replace(/^Error:/,"").trim()),o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Sign Up Failed",errors:a},parent:"body",controller:ErrorDialog})}else n.info("Sign Up Success!",i),r.authWithPassword({email:t.email,password:t.password},function(t,e){if(s.prop("disabled",!1),t){n.warn("Log In Failed",t);var i=[];i.push(t.toString().replace(/^Error:/,"").trim()),o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Log In Failed",errors:i},parent:"body",controller:ErrorDialog})}})})}})}}}}]),app.service("AppService",["$rootScope","$mdDialog","$log","$location","$timeout","fb",function(t,e,o,n,i,r){this.config={note:void 0,notes:[],updated:Date.now()},this.reset=function(){this.title="Notes",this.auth=0,this.reloading=0,this.timeout=void 0,this.snapshot=void 0,this.userRef=void 0,this.accountRef=void 0,this.userRef=void 0,this.stateRef=void 0,this.note=void 0,this.notes=[],this.account={}},this.logout=function(){this.reset(),t.$emit("load",this.notes,this.note),r.unauth()},this.key=function(){return CryptoJS.MD5(this.auth.uid).toString()},this.encrypt=function(t){return CryptoJS.AES.encrypt(t,this.key()).toString()},this.decrypt=function(t){return CryptoJS.AES.decrypt(t,this.key()).toString(CryptoJS.enc.Utf8)},this.handle=function(t,e){this.snapshot=t,o.info("Firebase "+e+": "+t.key()),"added"===e&&("state"===t.key()?this.setState(t.val()):"account"===t.key()&&(this.account=t.val()))},this.setAuth=function(t){o.log("setAuth");var e=this;e.reset(),e.auth=t,e.userRef=r.child(e.key()),e.userRef.on("child_added",function(t){e.handle(t,"added")}),e.userRef.on("child_changed",function(t){e.handle(t,"changed")}),e.userRef.on("child_removed",function(t){e.handle(t,"removed")}),e.userRef.on("child_moved",function(t){e.handle(t,"moved")}),e.stateRef=e.userRef.child("state"),e.accountRef=e.userRef.child("account"),/^\/signup\/?/.test(n.path())?e.signup():/^\/login\/?/.test(n.path())&&n.path("/")},this.getAuth=function(){return this.auth},this.setTitle=function(t){this.title=t,e.hide()},this.getTitle=function(){return this.title},this.setState=function(e){o.log("setState");var n=this;if(e&&(e=this.decrypt(e),/^\{/.test(e))){state=JSON.parse(e),n.note={},n.notes=state.notes;for(var r=0;r<n.notes.length;r++){var a=n.notes[r];a.id==state.note.id?(o.log("Found!"),n.note=a):o.log("Not Found!")}i(function(){o.log("Emit: load"),t.$emit("load",n.notes,n.note)},100)}},this.getName=function(){return this.account&&this.account.first_name?this.account.first_name+" "+this.account.last_name:""},this.signup=function(){$scope=angular.element(document.getElementById("content")).scope(),this.account={first_name:$scope.first_name,last_name:$scope.last_name,email:$scope.email};var t={note:this.note,notes:this.notes,updated:Date.now()},e=JSON.stringify(t);e=this.encrypt(e),this.userRef.set({account:this.account,state:e},function(){n.path("/")})},this.update=function(){o.log(this.note);var t=this.note.id,e=Date.now();t?(this.note.updated=e,o.log("UPDATE NOTE...")):(t=this.notes.length?_.max(this.notes,function(t){return t.id}).id++:1,note.id=t,note.created=e,note.updated=e,this.notes.unshift(note),this.show(note),o.log("ADD NOTE...")),this.updated=e,this.save()},this.get=function(t){return t=t||this.id,_.findWhere(this.notes,{id:t})},this.add=function(){this.note={},this.save(),t.$emit("load",this.notes,this.note)},this.remove=function(o){"object"==typeof o&&o.id&&(o=o.id);var n="number"==typeof o?_.findWhere(this.notes,{id:o}):this.note;if(n){var i=this;e.show({templateUrl:"views/dialogs/confirm.html",locals:{params:{title:"Delete Note?",message:'<div class="center">You are about to delete the note named...<br /><br /><strong>'+n.name+"</strong></div>",onOk:function(){i.notes=_.without(i.notes,n),i.note=void 0,i.save(),t.$emit("load",i.notes,i.note)},onCancel:function(){}}},parent:"body",controller:ConfirmDialog})}},this.show=function(e){o.log(e);var n=this;this.note=e,i(function(){t.$emit("load",n.notes,n.note)},100)},this.save=function(){var t={};for(var e in this.config)t[e]=this[e];var o=JSON.stringify(t);o=this.encrypt(o),this.stateRef.set(o),this.accountRef.set(this.account)},this.reload=function(){if(this.snapshot&&!this.reloading){this.reloading=!0;var t,e=this.snapshot.val();if(e=this.decrypt(e),/^\{/.test(e))if(t=JSON.parse(e),t.updated>this.updated){var o=$("#modal-confirm");$(".modal-title",o).text("Reload?"),$(".modal-body",o).html('<p>A note was updated & saved remotely.<br class="hidden-xs" />            Do you want to reload your local notes?</p>'),o.off("hidden.bs.modal").on("hidden.bs.modal",function(t){a.reloading=!1}),$(".btn-yes",o).off("click").on("click",function(n){o.modal("hide"),e=a.snapshot.val(),e=a.decrypt(e),t=JSON.parse(e);for(var i=0;i<t.notes.length;i++)delete t.notes[i].$$hashKey;this.notes=t.notes,this.note&&this.note.id&&(this.note=$scope.get(this.note.id)),this.$apply(),a.reloading=!1}),$(".btn-no",o).off("click").on("click",function(t){a.reloading=!1}),o.modal()}else a.reloading=!1;else a.reloading=!1}};var a=this;r.onAuth(function(t){t?(o.info("Logged In"),a.setAuth(t)):(o.warn("Logged Out!"),/^\/signup\/?/.test(n.path())||n.path("/login"))})}]);