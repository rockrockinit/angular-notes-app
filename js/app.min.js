function ErrorDialog(t,e,o,i){t.title=o,t.errors=i,t.close=function(){e.hide()}}function LoadingDialog(t,e,o){t.title=o,t.close=function(){e.hide()}}function ConfirmDialog(t,e,o,i){t.title=i.title||"Confirm",t.message=o.trustAsHtml(i.message||""),t.ok=function(){"function"==typeof i.onOk&&i.onOk.call(t,i),e.hide()},t.cancel=function(){"function"==typeof i.onCancel&&i.onCancel.call(t,i),e.hide()}}ErrorDialog.$inject=["$scope","$mdDialog","title","errors"],LoadingDialog.$inject=["$scope","$mdDialog","title"],ConfirmDialog.$inject=["$scope","$mdDialog","$sce","params"],Date.now||(Date.now=function(){return(new Date).getTime()}),window.console&&window.console.log||(window.console={log:function(){}});var cms={submit:function(t){if(t="object"==typeof t?t:{},"undefined"==typeof t.form?(0===$("#cms-hidden-form").length&&$("body").append('<form id="cms-hidden-form" name="cms-hidden-form" action="" method="post"></form>'),t.form=$("#cms-hidden-form")):"string"==typeof t.form&&(t.form=$(t.form)),"object"==typeof t.form&&1===t.form.length){var e=t.form,o="string"==typeof t.data?$.query(t.data):t.data;if(e.html(""),e.attr("action",""),"string"==typeof t.action&&e.attr("action",t.action),e.get(0).setAttribute("target",""),"string"==typeof t.target){e.get(0).setAttribute("target",t.target);var i=$("#"+t.target);i.length&&(i.off("load"),"function"==typeof t.onload&&i.load(t.onload))}if("object"==typeof o)for(var n in o)if("string"==typeof o[n]||"number"==typeof o[n])e.append("<input type='hidden' name='"+n+"' value='"+unescape(urldecode(o[n]).replace(/\'/gi,"&apos;"))+"' />");else if($.isArray(o[n]))for(var r=0;r<o[n].length;r++)e.append("<input type='hidden' name='"+n+"[]' value='"+unescape(urldecode(o[n][r]).replace(/\'/gi,"&apos;"))+"' />");e.submit()}return!1}},pages=angular.module("pages",[]),firebase_url="https://rodriguez.firebaseio.com/notes",app=angular.module("NotesApp",["pages","ngMdIcons","ngMaterial","ngMessages","ngRoute","contenteditable"]);app.config(["$routeProvider","$mdThemingProvider",function(t,e){e.theme("default").primaryPalette("blue").accentPalette("lime"),t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/export",{templateUrl:"views/export.html",controller:"ExportCtrl"}).otherwise({redirectTo:"/"})}]),app.factory("fb",[function(){return new Firebase(firebase_url)}]),/edrodriguez\.com$/i.test(location.host)&&(!function(t,e,o,i,n,r,a){t.GoogleAnalyticsObject=n,t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},t[n].l=1*new Date,r=e.createElement(o),a=e.getElementsByTagName(o)[0],r.async=1,r.src=i,a.parentNode.insertBefore(r,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-66592052-1","auto"),ga("send","pageview")),function(t){var e=navigator.userAgent.toLowerCase();t.browser={version:(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)},t.fn.selectRange=function(t,e){return e||(e=t),this.each(function(){if("undefined"!=typeof this.setSelectionRange)this.focus(),this.setSelectionRange(t,e);else if("undefined"!=typeof this.createTextRange){var o=this.createTextRange();o.collapse(!0),o.moveEnd("character",e),o.moveStart("character",t),o.select()}})},t.fn.outerHTML=function(e){return e?this.before(e).remove():t("<p>").append(this.eq(0).clone()).html()},t.fn.serializeObject=function(){var e={},o=this.serializeArray(),i=t("[data-hint]",this);return t.each(o,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||"";var t=i.filter('[name="'+this.name+'"]');1===t.length&&e[this.name]===t.attr("data-hint")&&(e[this.name]="")}),e},t.fn.serializeElement=function(){for(var e=t(this),o=t("<form></form>").append(e.clone()),i=["textarea","select",'input[type="text"]','input[type="hidden"]','input[type="checkbox"]','input[type="radio"]'],n=0;n<i.length;n++){var r=i[n],a=e.find(r);a.each(function(e){var i=t(this);i.get(0).tagName.match(/^(input)$/i)&&"undefined"!=typeof i.attr("type")&&i.attr("type").match(/^(checkbox|radio)$/i)?t(o).find(r).eq(e).attr("checked",i.attr("checked")):t(o).find(r).eq(e).val(i.val())})}return o.serializeObject()},t.fn.imagesLoaded=function(e,o){o="undefined"==typeof o?0:o;var i=t("img",this),n=i.length,r=1;t.cms.log("Images Total: "+i.length),i.length?i.each(function(a,s){var l=t(this);l.on("load",function(a){r&&(n--,o?(t.cms.log("Loaded"),n||("function"==typeof e&&e.call(i,a),t.cms.log("Images Loaded"),r=0)):("function"==typeof e&&e.call(i,a),n||(t.cms.log("Images Loaded"),r=0)))}),(this.complete||void 0===this.complete)&&(this.src=this.src)}):"function"==typeof e&&e.call(this)},t.hook=function(e,o){e="string"==typeof e?e.split(/,? +/):e,e=e instanceof Array?e:[];for(var i=0;i<e.length;i++){var n=e[i];if(!isEmpty(n)&&t.fn[n]){var r=t.fn[n];r&&(t.fn[n]=function(){var t=r.apply(this,arguments);return o(this,n,arguments),t},t.cms.log(n))}}},t.getJSONP=function(e){function o(t,e,o,n){t.error(i,n)}e.dataType="jsonp";var i=t.ajax(e),n=t(document.getElementsByTagName("head")[0].firstChild),r=n.attr("src")||"",a=(r.match(/callback=(\w+)/)||[])[1];if(a){var s=0,l=window[a];n[0].onerror=function(t){n.remove(),o(e,{},"error",t),clearTimeout(s)},e.timeout&&(window[a]=function(t){clearTimeout(s),l(t),l=null},s=setTimeout(function(){n.remove(),o(e,{},"timeout"),l&&(window[a]=function(){})},e.timeout))}},t.query=function(e){var o={};return e="undefined"==typeof e?document.location.search:e,e&&(e.indexOf("?")>=0&&(e=e.substring(e.indexOf("?")+1)),e.indexOf("#")>=0&&(e=e.substring(0,e.indexOf("#"))),e=e.replace(/\&amp;/,"&"),e=e.replace(/\&$/,""),t.each(e.split("&"),function(){var t=this.split("=");if(2===t.length){var e=t[0],i=t[1];/^[0-9.]+$/.test(i)&&(i=parseFloat(i)),"true"==i&&(i=!0),"false"==i&&(i=!1),("number"==typeof i||"boolean"==typeof i||i.length>0)&&(o[e]=i)}else 1===t.length&&(o[t[0]]="")})),o},t.extend({stringify:function(e){if("JSON"in window)return JSON.stringify(e);var o=typeof e;if("object"!=o||null===e)return"string"==o&&(e='"'+e+'"'),String(e);var i,n,r=[],a=e&&e.constructor==Array;for(i in e)n=e[i],o=typeof n,e.hasOwnProperty(i)&&("string"==o?n='"'+n+'"':"object"==o&&null!==n&&(n=t.stringify(n)),r.push((a?"":'"'+i+'":')+String(n)));return(a?"[":"{")+String(r)+(a?"]":"}")}})}(jQuery),app.controller("AppCtrl",["$scope","$timeout","$mdSidenav","$log","$rootScope","AppService",function(t,e,o,i,n,r){function a(o,i,n){var r;return function(){var n=t,a=Array.prototype.slice.call(arguments);e.cancel(r),r=e(function(){r=void 0,o.apply(n,a)},i||10)}}function s(t){return a(function(){o(t).toggle()},200)}function l(t){return function(){o(t).toggle()}}i.info("AppCtrl"),angular.element(document).ready(function(){document.getElementById("loading").style.display="none",document.getElementById("notes-app").style.display="flex"}),t.app=r,t.title=r.title,t.$watch("app.getTitle()",function(e){console.log(e),t.title=e}),t.auth=function(){return r.getAuth()},t.add=function(){r.add(),o("left").close()},t.toggleLeft=s("left"),t.toggleRight=l("right"),t.isOpenRight=function(){return o("right").isOpen()}}]),pages.controller("ExportCtrl",["$scope","$location","$mdDialog","$log","AppService","$sce","fb",function(t,e,o,i,n,r,a){if(i.info("ExportCtrl"),n.getAuth()||e.path("/login"),n.setTitle("Export"),n.notes){for(var s=JSON.parse(JSON.stringify(n.notes)),l=0;l<s.length;l++){var c=s[l].note;c=c.replace(/<br>/gi,"[br]");var p=$("<div></div>").html(c);s[l].note=p.text().replace(/\[br\]/gi,"\n"),s[l].created&&(s[l].created=moment(s[l].created).format("M/D/YY h:mma")),s[l].updated&&(s[l].updated=moment(s[l].updated).format("M/D/YY h:mma"))}s=JSON.stringify(s),s=s.replace(/\",\"/gi,'",\n"'),s=s.replace(/(\d),\"/gi,'$1,\n"'),s=s.replace(/\},\{/gi,"},\n{"),s=s.replace(/\{\"/gi,'{\n"'),s=s.replace(/\"\}/gi,'"\n}'),s=s.replace(/^\"/gim,'	"'),s=s.replace(/\":(\"|\d)/gi,'": $1'),s=s.replace(/\s*\"\$\$hashKey\":\s*\"object\:\d+\"\n/gi,"\n"),s=s.replace(/\s*\"id\"\: \d+,\n/gi,"\n"),s=r.trustAsHtml(s),t.notes=s}else t.notes=""}]),app.controller("LeftCtrl",["$scope","$timeout","$log","$mdSidenav","$rootScope","AppService","$location",function(t,e,o,i,n,r,a){o.info("LeftCtrl"),t.notes=[],t.note={},t.isSelected=function(e){return e&&t.note?e.id===t.note.id:0},t.close=function(){i("left").close()},t.show=function(t){/^\/$/.test(a.$$path)||a.path("/"),r.show(t),i("left").close()},t.hide=function(e){if(t.search){var o=new RegExp(t.search,"gi");return!o.test(e.name)}return!1},t.auth=r.getAuth,n.$on("load",function(e,o,i){t.notes=o,t.note=i})}]),pages.controller("LoginCtrl",["$scope","$location","$mdDialog","$log","AppService","fb",function(t,e,o,i,n,r){i.info("LoginCtrl"),n.setTitle("Log in to Notes"),t.email="",t.password="",t.login=function(a){var s=!0;if(a&&a.currentTarget&&/^input$/i.test(a.currentTarget.tagName)&&a.which&&(s=13===a.which?!0:!1),s){var l=[];if(t.email||l.push("Email is required"),t.password||l.push("Password is required"),l.length)o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Log In Error",errors:l},controller:ErrorDialog});else{var c=$(a.currentTarget);c.prop("disabled",!1),o.show({templateUrl:"views/dialogs/loading.html",locals:{title:"Logging In..."},controller:LoadingDialog,onComplete:function(){r.authWithPassword({email:t.email,password:t.password},function(r,a){if(c.prop("disabled",!1),r){i.warn("Log In Failed!",r);var s=[];s.push(r.toString().replace(/^Error:/,"").trim()),o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Log In Failed",errors:s},controller:ErrorDialog})}else o.hide(),n.setAuth(a),t.$apply(function(){e.path("/")})})}})}}}}]),pages.controller("MainCtrl",["$scope","$location","$rootScope","$log","AppService",function(t,e,o,i,n){i.info("MainCtrl"),n.getAuth()||e.path("/login"),n.setTitle("Notes"),t.notes=[],t.note={},t.formatDate=function(t,e){return moment(t).format(e)},t.update=function(){n.update(this.note)},t.remove=function(){n.remove(this.note)},t.isEmpty=function(t){return t=t?t.replace(/\<br\s*\/?\>/gi,"").trim():"",""===t},o.$on("load",function(e,o,i){t.notes=o,t.note=i}),n.init()}]),app.controller("RightCtrl",["$scope","$timeout","$mdSidenav","$log","$rootScope","fb","AppService",function(t,e,o,i,n,r,a){i.info("RightCtrl"),t.close=function(){o("right").close()},t.logout=function(){a.logout(),o("right").close()}}]),pages.controller("SignupCtrl",["$scope","$location","$mdDialog","$log","AppService","fb",function(t,e,o,i,n,r){i.info("SignupCtrl"),n.getAuth()&&e.path("/"),n.setTitle("Sign up for Notes"),t.email="",t.password="",t.signup=function(n){var a=!0;if(n&&n.currentTarget&&/^input$/i.test(n.currentTarget.tagName)&&n.which&&(a=13===n.which?!0:!1),a){var s=[];if(t.first_name||s.push("First Name is required"),t.last_name||s.push("Last Name is required"),t.email||s.push("Email is required"),t.password||s.push("Password is required"),s.length)o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Sign Up Error",errors:s},controller:ErrorDialog});else{var l=$(n.currentTarget);l.prop("disabled",!1),o.show({templateUrl:"views/dialogs/loading.html",locals:{title:"Signing Up..."},controller:LoadingDialog,onComplete:function(){r.createUser({email:t.email,password:t.password},function(n,a){if(n){i.warn("Sign Up Failed",n),l.prop("disabled",!1);var s=[];s.push(n.toString().replace(/^Error:/,"").trim()),o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Sign Up Failed",errors:s},controller:ErrorDialog})}else i.info("Sign Up Success!",a),r.authWithPassword({email:t.email,password:t.password},function(n,r){if(l.prop("disabled",!1),n){i.warn("Log In Failed",n);var a=[];a.push(n.toString().replace(/^Error:/,"").trim()),o.show({templateUrl:"views/dialogs/errors.html",locals:{title:"Log In Failed",errors:a},controller:ErrorDialog})}else o.hide(),t.$apply(function(){e.path("/")})})})}})}}}}]),app.service("AppService",["$rootScope","$mdDialog","$log","$location","fb",function(t,e,o,i,n){n.onAuth(function(t){t?o.info("Logged In"):(o.warn("Logged Out!"),/^\/signup\/?/.test(i.path())||i.path("/login"))}),this.config={note:void 0,notes:[],updated:Date.now()},this.title="Notes",this.auth=n.getAuth(),this.once=0,this.reloading=0,this.timeout=void 0,this.snapshot=void 0,this.userRef=void 0,this.setAuth=function(t){this.auth=t},this.getAuth=function(){return this.auth},this.setTitle=function(t){this.title=t},this.getTitle=function(){return this.title},this.logout=function(){this.title="Notes",this.auth=0,this.once=0,this.reloading=0,this.timeout=void 0,this.snapshot=void 0,this.userRef=void 0,this.auth=void 0,this.notes=[],this.note={},t.$emit("load",this.notes,this.note),n.unauth()},this.key=function(){return CryptoJS.MD5(this.auth.uid).toString()},this.encrypt=function(t){return CryptoJS.AES.encrypt(t,this.key()).toString()},this.decrypt=function(t){return CryptoJS.AES.decrypt(t,this.key()).toString(CryptoJS.enc.Utf8)},this.process=function(t,e){o.info(e),this.snapshot=t},this.update=function(t){this.note=t;var e=this.note.id,o=Date.now();e?this.note.updated=o:(e=this.notes.length?_.max(this.notes,function(t){return t.id}).id++:1,t.id=e,t.created=o,t.updated=o,this.notes.unshift(t),this.show(t)),this.updated=o,this.save()},this.get=function(t){return t=t||this.id,_.findWhere(this.notes,{id:t})},this.add=function(){this.note={},this.save(),t.$emit("load",this.notes,this.note)},this.remove=function(o){"object"==typeof o&&o.id&&(o=o.id);var i="number"==typeof o?_.findWhere(this.notes,{id:o}):this.note;if(i){var n=this;e.show({templateUrl:"views/dialogs/confirm.html",locals:{params:{title:"Delete Note?",message:'<div class="center">You are about to delete the note named...<br /><br /><strong>'+i.name+"</strong></div>",onOk:function(){n.notes=_.without(n.notes,i),n.note=void 0,n.save(),t.$emit("load",n.notes,n.note)},onCancel:function(){}}},controller:ConfirmDialog})}},this.show=function(e){this.note=e,this.save(),t.$emit("load",this.notes,this.note)},this.save=function(){var t={};for(var e in this.config)t[e]=this[e];var o=JSON.stringify(t);localStorage.setItem("notes",o),o=this.encrypt(o),this.userRef.set({state:o})},this.reload=function(){if(this.snapshot&&!this.reloading){this.reloading=!0;var t,e=this.snapshot.val();if(e=this.decrypt(e),/^\{/.test(e))if(t=JSON.parse(e),t.updated>this.updated){var o=$("#modal-confirm");$(".modal-title",o).text("Reload?"),$(".modal-body",o).html('<p>A note was updated & saved remotely.<br class="hidden-xs" />            Do you want to reload your local notes?</p>'),o.off("hidden.bs.modal").on("hidden.bs.modal",function(t){$app.reloading=!1}),$(".btn-yes",o).off("click").on("click",function(i){o.modal("hide"),e=$app.snapshot.val(),e=$app.decrypt(e),t=JSON.parse(e);for(var n=0;n<t.notes.length;n++)delete t.notes[n].$$hashKey;this.notes=t.notes,this.note&&this.note.id&&(this.note=$scope.get(this.note.id)),this.$apply(),$app.reloading=!1}),$(".btn-no",o).off("click").on("click",function(t){$app.reloading=!1}),o.modal()}else $app.reloading=!1;else $app.reloading=!1}},this.init=function(e){var i=this;if(this.auth){i.once||(i.userRef=n.child(i.key()),i.userRef.on("child_added",function(t){o.info("Firebase Added"),i.once||(i.once=1,i.init(t))}),i.userRef.on("child_changed",function(t){i.process(t,"Firebase Changed")}),i.userRef.on("child_removed",function(t){i.process(t,"Firebase Removed")}),i.userRef.on("child_moved",function(t){i.process(t,"Firebase Moved")}));var r=0;for(var a in i.config)this[a]=i.config[a];if(!r&&e){var s=e.val();if(s&&(s=i.decrypt(s),/^\{/.test(s))){r=JSON.parse(s);for(var l=0;l<r.notes.length;l++)delete r.notes[l].$$hashKey}}r||(r=localStorage.getItem("notes"),r=/^(\{|\[)/.test(r)?JSON.parse(r):0,r||(r=i.config,localStorage.setItem("notes",JSON.stringify(r))));for(var a in r)/^\$/.test(a)||(i[a]=r[a]);i.note&&i.note.id&&(i.note=i.get(i.note.id)),t.$emit("load",this.notes,this.note)}}}]);